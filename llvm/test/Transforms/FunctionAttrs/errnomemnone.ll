; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --check-attributes --check-globals --version 2
; RUN: opt -passes=function-attrs -S < %s | FileCheck --check-prefixes=FNATTRS %s

; Stack-allocated memory cannot alias errno.
define float @cannot_alias_errno(float %f) {
; FNATTRS: Function Attrs: memory(readwrite, errnomem: none)
; FNATTRS-LABEL: define float @cannot_alias_errno
; FNATTRS-SAME: (float [[F:%.*]]) #[[ATTR0:[0-9]+]] {
  %p = alloca float
  call void @escape(ptr %p)
  store float 0.0, ptr %p
  call float @sinf(float %f)
  %v = load float, ptr %p
  ret float %v
}

; Accesses to memory larger than integer-size cannot alias errno.
define double @cannot_alias_errno_2(ptr %p, float %f) {
; FNATTRS: Function Attrs: memory(readwrite, errnomem: none)
; FNATTRS-LABEL: define double @cannot_alias_errno_2
; FNATTRS-SAME: (ptr [[P:%.*]], float [[F:%.*]]) #[[ATTR0]] {
  call void @escape(ptr %p)
  store double 0.0, ptr %p
  call float @sinf(float %f)
  %v = load double, ptr %p
  ret double %v
}

declare void @escape(ptr %p)
declare float @sinf(float) memory(errnomem: write)
